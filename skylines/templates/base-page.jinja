{% extends "base.jinja" %}
{% from 'topbar.jinja' import topbar with context %}
{% from 'macros/flash.jinja' import insert_flash_message with context %}

{% block body -%}
{{ topbar(active_page) }}

<div class="container">
    <div class="content">

        {% if self.title() -%}
        <div class="page-header">
            {%- if self.title_right() -%}
            <div class="pull-right">{%- block title_right %}{% endblock %}</div>
            {%- endif %}

            <h1>{{ self.title() }}</h1>

            {%- if header_tabs -%}
            <div class="page-header-tabs">
                <ul class="nav nav-tabs">
                    {% for href, id, caption in header_tabs -%}
                    <li{% if active_header_tab == id %} class="active"{% endif %}>
                        <a href="{{ href }}">{{ caption }}</a>
                    </li>
                    {%- endfor %}
                </ul>
            </div>
            {%- endif %}
        </div>
        {%- endif %}

        <div class="row">
            <div class="span12">
                {{ insert_flash_message(False) }}
                {%- block content %}{% endblock %}
            </div>
        </div>
    </div>

    <p class="footer">
        {% block footer -%}
        &copy; <a href="{{ url_for('about.skylines_team') }}">{{ _('The SkyLines Team') }}</a> -
        <a href="{{ url_for('about.imprint') }}">{% trans %}Imprint{% endtrans %}</a>
        {%- if debug %}
        {% with num_queries=queries|count -%}
        - <a href="#debug" data-toggle="collapse" title="Show Queries"{% if num_queries > 15 %} style="background:red"{% endif %}>{{ num_queries }} Queries</a>
        {%- endwith %}
        {%- endif %}
        {%- endblock %}
    </p>

    {%- if debug -%}
    <div id="debug" class="collapse">
        {% for query in queries -%}
        <div class="query">
            <b>Query #{{ loop.index }}</b>
            <span class="badge {{ 'badge-success' if query.duration < 0.5 else 'badge-error'}}">{{ h.format_decimal(query.duration * 1000) }} ms</span>
            <dl>
                <dt>Statement</dt>
                <dd>{{ query.statement_with_params }}</dd>

                <dt>Parameters</dt>
                <dd>{{ query.parameters }}</dd>

                <dt>Context</dt>
                <dd>{{ query.context }}</dd>
            </dl>
        </div>
        {%- endfor %}
    </div>
    {%- endif %}
</div>
{%- endblock %}
