{% from 'statistics/flights-table.jinja' import render_flights_table with context %}
{% from 'statistics/distance-table.jinja' import render_distance_table with context %}
{% from 'statistics/duration-table.jinja' import render_duration_table with context %}
{% from 'statistics/pilots-table.jinja' import render_pilots_table with context %}
{% from 'macros/links.jinja' import user_link, club_link %}


{% extends "base-page.jinja" %}
{% set active_page = "statistics" %}


{% block title -%}
{% if selected_pilot -%}
  {% trans pilot=user_link(selected_pilot) -%}
    Statistics <small>of {{ pilot }}</small>
  {%- endtrans %}

{%- elif selected_club %}
  {% trans club=club_link(selected_club) -%}
    Statistics <small>of {{ club }}</small>
  {%- endtrans %}

{%- elif airport %}
  {% trans airport=airport.name|e -%}
    Statistics <small>from {{ airport }}</small>
  {%- endtrans %}

{%- else %}
  {% trans %}Statistics{% endtrans -%}

{%- endif %}
{%- endblock %}


{%- block content %}
{% if pilot or club or airport or g.identity -%}
<ul class="nav nav-pills">
  <li{% if not (pilot or club or airport) %} class="active"{% endif %}><a href="/statistics/">SkyLines</a></li>

  {% if airport -%}
  <li class="active"><a href="/statistics/airport/{{ airport.id }}">{{ airport|e }}</a></li>
  {%- endif %}

  {% if club -%}
  <li class="active"><a href="/statistics/club/{{ club.id }}">{{ club|e }}</a></li>
  {%- endif %}

  {% with my_club=g.identity and g.identity['user'] and g.identity['user'].club  -%}
  {% if my_club and club != my_club -%}
  <li><a href="/statistics/club/{{ my_club.id }}">{{ my_club|e }}</a></li>
  {%- endif %}
  {%- endwith %}

  {% if pilot -%}
  <li class="active"><a href="/statistics/pilot/{{ pilot.id }}">{{ pilot|e }}</a></li>
  {%- endif %}

  {% with my_club=g.identity and g.identity['user'] -%}
  {% if my_club and pilot != my_club -%}
  <li><a href="/statistics/pilot/{{ my_club.id }}">{{ my_club|e }}</a></li>
  {%- endif %}
  {%- endwith %}
</ul>
{%- endif %}

<h1>{% trans %}Flights{% endtrans %}</h1>
{{ render_flights_table(years, max_flights, sum_flights) }}

<h1>{% trans %}Distance{% endtrans %}</h1>
{{ render_distance_table(years, max_distance, sum_distance) }}

<h1>{% trans %}Flight Time{% endtrans %}</h1>
{{ render_duration_table(years, max_duration, sum_duration) }}

{% if not pilot -%}
<h1>{% trans %}Pilots{% endtrans %}</h1>
{{ render_pilots_table(years, max_pilots) }}
{%- endif %}
{%- endblock %}
